{"version":3,"sources":["webpack:///path---activerecord-has-many-through-multiple-models-c9cdbe346a826818a075.js","webpack:///./.cache/json/activerecord-has-many-through-multiple-models.json"],"names":["webpackJsonp","990","module","exports","data","site","siteMetadata","title","author","markdownRemark","id","html","frontmatter","date","imageUrl","image","pathContext","path"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,MAAQC,cAAgBC,MAAA,cAAAC,OAAA,gBAA8CC,gBAAmBC,GAAA,mJAAAC,KAAA,87HAAAC,aAA4mIL,MAAA,gDAAAM,KAAA,iBAAAC,SAAA,KAAAC,MAAA,QAA+GC,aAAgBC,KAAA","file":"path---activerecord-has-many-through-multiple-models-c9cdbe346a826818a075.js","sourcesContent":["webpackJsonp([222569608217608],{\n\n/***/ 990:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"Justin Ball\",\"author\":\"Justin Ball\"}},\"markdownRemark\":{\"id\":\"/Users/jbasdf/projects/justinball/src/posts/2014-03-24-activerecord-has_many-through-multiple-models/index.md absPath of file >>> MarkdownRemark\",\"html\":\"<p>More than a few times now I've run into a situation where I really need to be able to relate one object to another through multiple tables - basically use 'has_many' twice.</p>\\n<p>Here's an example set of objects where a user can have many products but to get to the products you have to first go through associations and then through companies.\\n'user.companies' is straight forward ActiveRecord but 'user.companies.products' won't give you what you need.</p>\\n<pre><code class=\\\"ruby\\\">\\n\\nclass User < ActiveRecord::Base\\n  has_many :associations\\n  has_many :companies, :through => :associations\\nend\\n\\nclass Association < ActiveRecord::Base\\n  belongs_to :user\\n  belongs_to :company\\nend\\n\\nclass Company < ActiveRecord::Base\\n  has_many :associations\\n  has_many :users, :through => :associations\\n  has_many :products\\nend\\n\\nclass Product < ActiveRecord::Base\\n  belongs_to :company\\nend\\n\\n</pre></code>\\n<p>What I really want to do is setup an efficient query that bypasses the companies table. The associations table and the products table both have a 'company_id'.\\nWhat if we use those keys to relate the user to products? Doing so yields a bit of code like that below. Have a look at the comments for the details.</p>\\n<pre><code class=\\\"ruby\\\">\\n\\nclass User < ActiveRecord::Base\\n  has_many :associations\\n  has_many :companies, :through => :associations\\n\\n  # Step 1 #####################################################\\n  # This relationship bypasses the companies table to get products that a user has a relationship with through the companies table.\\n  # The real magic happens when we specify 'source'. ActiveRecord knows to use the 'associations' table because we specify it using through.\\n  # We then direct it to the 'products' source. Now go to the comments in 'Association' for the next step.\\n  ##############################################################\\n  has_many :products, source: :product, through: :associations\\n\\nend\\n\\nclass Association < ActiveRecord::Base\\n  belongs_to :user\\n  belongs_to :company\\n\\n  # Step 2 #####################################################\\n  # Create a new 'belongs_to' relationship (used by 'source' in the 'has_many through' relationship in users).  Associate directly with a product\\n  # using association.company_id and product.company_id to bypass a query to the companies table. We do this by specifying the foreign_key which is the\\n  # name of the key in the products table as well as the primary_key which is the key from the associations table.\\n  ##############################################################\\n  belongs_to :product, foreign_key: :company_id, primary_key: :company_id\\n\\nend\\n\\nclass Company < ActiveRecord::Base\\n  has_many :associations\\n  has_many :users, :through => :associations\\n  has_many :products\\nend\\n\\nclass Product < ActiveRecord::Base\\n  belongs_to :company\\n\\n  # Step 3 #####################################################\\n  # This step isn't required but it will setup the bidirectional relationship back to users in case we want to be able to do something like 'product.users'.\\n  # Associate directly with an association using the company_id to bypass a query to the companies table.\\n  # Specify that we have many associations using the products.company_id as the primary key and associations.company_id as the foreign_key.\\n  # Then we can setup a relationship with users using the associations table.\\n  has_many :associations, primary_key: :company_id, foreign_key: :company_id\\n  has_many :users, through: :associations\\n\\nend\\n</pre></code>\\n<p>There you have it. A has_many relationship through multiple tables (more or less - we bypass the companies table but that's a good thing for performance).\\nNow we can do exciting stuff like this:</p>\\n<pre><code class=\\\"ruby\\\">\\n\\n  result = user.products.select(\\\"count(associations.id) as total, associations.state, count(products.id) as products_total, products.category_id\\\").group(\\\"state, category_id\\\").order('category_id')\\n\\n</pre></code>\",\"frontmatter\":{\"title\":\"ActiveRecord has_many through multiple models\",\"date\":\"March 24, 2014\",\"imageUrl\":null,\"image\":null}}},\"pathContext\":{\"path\":\"/activerecord-has_many-through-multiple-models\"}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---activerecord-has-many-through-multiple-models-c9cdbe346a826818a075.js","module.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"Justin Ball\",\"author\":\"Justin Ball\"}},\"markdownRemark\":{\"id\":\"/Users/jbasdf/projects/justinball/src/posts/2014-03-24-activerecord-has_many-through-multiple-models/index.md absPath of file >>> MarkdownRemark\",\"html\":\"<p>More than a few times now I've run into a situation where I really need to be able to relate one object to another through multiple tables - basically use 'has_many' twice.</p>\\n<p>Here's an example set of objects where a user can have many products but to get to the products you have to first go through associations and then through companies.\\n'user.companies' is straight forward ActiveRecord but 'user.companies.products' won't give you what you need.</p>\\n<pre><code class=\\\"ruby\\\">\\n\\nclass User < ActiveRecord::Base\\n  has_many :associations\\n  has_many :companies, :through => :associations\\nend\\n\\nclass Association < ActiveRecord::Base\\n  belongs_to :user\\n  belongs_to :company\\nend\\n\\nclass Company < ActiveRecord::Base\\n  has_many :associations\\n  has_many :users, :through => :associations\\n  has_many :products\\nend\\n\\nclass Product < ActiveRecord::Base\\n  belongs_to :company\\nend\\n\\n</pre></code>\\n<p>What I really want to do is setup an efficient query that bypasses the companies table. The associations table and the products table both have a 'company_id'.\\nWhat if we use those keys to relate the user to products? Doing so yields a bit of code like that below. Have a look at the comments for the details.</p>\\n<pre><code class=\\\"ruby\\\">\\n\\nclass User < ActiveRecord::Base\\n  has_many :associations\\n  has_many :companies, :through => :associations\\n\\n  # Step 1 #####################################################\\n  # This relationship bypasses the companies table to get products that a user has a relationship with through the companies table.\\n  # The real magic happens when we specify 'source'. ActiveRecord knows to use the 'associations' table because we specify it using through.\\n  # We then direct it to the 'products' source. Now go to the comments in 'Association' for the next step.\\n  ##############################################################\\n  has_many :products, source: :product, through: :associations\\n\\nend\\n\\nclass Association < ActiveRecord::Base\\n  belongs_to :user\\n  belongs_to :company\\n\\n  # Step 2 #####################################################\\n  # Create a new 'belongs_to' relationship (used by 'source' in the 'has_many through' relationship in users).  Associate directly with a product\\n  # using association.company_id and product.company_id to bypass a query to the companies table. We do this by specifying the foreign_key which is the\\n  # name of the key in the products table as well as the primary_key which is the key from the associations table.\\n  ##############################################################\\n  belongs_to :product, foreign_key: :company_id, primary_key: :company_id\\n\\nend\\n\\nclass Company < ActiveRecord::Base\\n  has_many :associations\\n  has_many :users, :through => :associations\\n  has_many :products\\nend\\n\\nclass Product < ActiveRecord::Base\\n  belongs_to :company\\n\\n  # Step 3 #####################################################\\n  # This step isn't required but it will setup the bidirectional relationship back to users in case we want to be able to do something like 'product.users'.\\n  # Associate directly with an association using the company_id to bypass a query to the companies table.\\n  # Specify that we have many associations using the products.company_id as the primary key and associations.company_id as the foreign_key.\\n  # Then we can setup a relationship with users using the associations table.\\n  has_many :associations, primary_key: :company_id, foreign_key: :company_id\\n  has_many :users, through: :associations\\n\\nend\\n</pre></code>\\n<p>There you have it. A has_many relationship through multiple tables (more or less - we bypass the companies table but that's a good thing for performance).\\nNow we can do exciting stuff like this:</p>\\n<pre><code class=\\\"ruby\\\">\\n\\n  result = user.products.select(\\\"count(associations.id) as total, associations.state, count(products.id) as products_total, products.category_id\\\").group(\\\"state, category_id\\\").order('category_id')\\n\\n</pre></code>\",\"frontmatter\":{\"title\":\"ActiveRecord has_many through multiple models\",\"date\":\"March 24, 2014\",\"imageUrl\":null,\"image\":null}}},\"pathContext\":{\"path\":\"/activerecord-has_many-through-multiple-models\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/activerecord-has-many-through-multiple-models.json\n// module id = 990\n// module chunks = 222569608217608"],"sourceRoot":""}