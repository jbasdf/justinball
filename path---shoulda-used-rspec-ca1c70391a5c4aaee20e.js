webpackJsonp([0xb35f4a202329],{2278:function(e,t){e.exports={data:{site:{siteMetadata:{title:"Justin Ball",author:"Justin Ball"}},markdownRemark:{id:"/Users/jbasdf/projects/justinball/src/posts/2010-09-18-shoulda-used-rspec/index.md absPath of file >>> MarkdownRemark",html:"<p>I've been updating the <a href=\"http://github.com/tatemae\">muck gems</a> to work with Rails 3. The change is significant and painful but in a good way. For the most part the change consists of deleting all the code you used to hack into the Rails framework and adding subclass of '::Rails::Engine'. I'll try to put together a detailed post explaining Rails 3 engines later.</p>\n<p>The nice thing about having a test suite in place is that you can rely on those tests to ensure the upgrade is smooth. I've always written my tests in <a href=\"http://github.com/thoughtbot/shoulda\">Shoulda</a>. I like the syntax and I love the macros. However, I'm switching everything over to RSpec. <a href=\"http://robots.thoughtbot.com/post/731871832/this-should-change-your-mind\">Thoughtbot has declared they won't abandon the Shoulda community, but since they've made the switch to RSpec for new projects it's pretty clear that Shoulda as a stand alone project has a limited life.</a></p>\n<p>Luckily I've used RSpec in a lot of other projects and it's an easy DSL to like. The conversion from shoulda to RSpec isn't a terribly difficult one. You basically need to replace \"context\" with describe and then remove your assert statements and replace then with 'should'.</p>\n<p>One of the most difficult issues I've had to deal with is my custom shoulda macros. From what I've read the move to BDD should inspire you to use fewer macros and instead focus on specific behavior. I think that philosophy is great, but I've already got a lot of code that uses the macros and so the macros need to be brought over. The change from shoulda macros to RSpec matchers is painful, but I think the code is cleaner and easier to read.</p>\n<p>For example, I have custom scope macros. Here's the shoulda macro:</p>\n<pre><code class=\"ruby\">\n  # Test for 'by_title' named scope which orders by title:\n  # scope :by_title, :order => \"title ASC\"\n  # requires that the class have a shoulda factory\n  def should_scope_by_title\n    klass = get_klass\n    factory_name = name_for_factory(klass)\n    context \"'by_title' title scope\" do\n      setup do\n        klass.delete_all\n        @first = Factory(factory_name, :title => 'a')\n        @second = Factory(factory_name, :title => 'b')\n      end\n      should \"sort by name\" do\n        assert_equal @first, klass.by_title[0]\n        assert_equal @second, klass.by_title[1]\n      end\n    end\n  end\n</pre></code>\n<p>And here's the RSpec matcher:</p>\n<pre><code class=\"ruby\">\n# Ensures that the model can sort by_title\n# requires that the class have a factory\n#\n# Tests scope:\n#   scope :by_title, :order => \"title ASC\"\n#\n# Examples:\n#   it { should scope_by_title }\n#\ndef scope_by_title\n  SortingMatcher.new(:by_title, :title)\nend\n\nclass SortingMatcher # :nodoc:\n\n  def initialize(scope, field)\n    @scope = scope\n    @field = field\n  end\n\n  def matches?(subject)\n    @subject = subject\n    @subject.class.delete_all\n    @first = Factory(factory_name, @field => 'a')\n    @second = Factory(factory_name, @field => 'b')\n    @first == @subject.class.send(@scope)[0] && @second == @subject.class.send(@scope)[1]\n  end\n\n  def failure_message\n    \"Expected #{factory_name} to scope by #{@scope} on #{@field}\"\n  end\n\n  def description\n    \"sort by title\"\n  end\n\n  private\n\n    def factory_name\n      @subject.class.name.underscore.to_sym\n    end\n\nend\n</pre></code>\n<p>I don't profess to be a master of either but my tests work so hopefully this helps someone if you're making the same transition.</p>",frontmatter:{title:"Shoulda used RSpec",date:"September 18, 2010",imageUrl:null,structuredHtml:null,image:null}}},pathContext:{}}}});
//# sourceMappingURL=path---shoulda-used-rspec-ca1c70391a5c4aaee20e.js.map